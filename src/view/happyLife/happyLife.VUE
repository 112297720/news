<template>
  <div>
    <van-loading v-show="loadingShow" color="black" size="1rem" class="loadingShow" />
    <div class='searchBox'>
      <p class="pageTitle">æ‚¦ç”Ÿæ´»</p>
      <!-- <img src="../../../static/images/search.png" class="searchBtn"> -->
      <p class="publishP" @click="onPublish" >å‘å¸ƒ</p><van-icon @click="onPublish"   name="edit" color="#fff" class="publishBtn" />
    </div>
    <div>
      <van-swipe :autoplay="4000" style="padding-top:.9rem;">
        <van-swipe-item v-for="(image, index) in images" :key="index">
          <div class="swipeTitleDiv" @click="clicked(index)">
            <!-- <p class="swipeTitle">12312</p> -->
          </div>
          <img class="swipeImg" v-lazy="image">
        </van-swipe-item>
      </van-swipe>
    </div>
    <van-pull-refresh v-model="isLoading" @refresh="onRefresh" pulling-text='â†“ä¸‹æ‹‰å³å¯åˆ·æ–°...' loosing-text='â†‘æ¾å¼€å³å¯åˆ·æ–°...' loading-text='æ­£åœ¨åˆ·æ–°åˆ—è¡¨...'>
      <div class="postList">
        <van-list :immediate-check=false v-model="loading" :finished="finished" @load="getList()" loading-text='æ­£åœ¨åŠ è½½...'>
          <div class="post" v-for="(item, index) in postList" :key="index">
            <div class="postView" @click="showPop(item)">
              <img :src="item.headImg" class='pheadImg'>
              <p class='nickName'>{{item.nickName}}</p>
              <p class='commDate'>{{item.publish_time|formatDate}}</p>
              <p class='pcommInfo'>{{item.content}}</p>
            </div>
            <div class="postImgs">
              <img :preview="index" class="postImg" v-for="(item, i) in item.images" :key="i" v-lazy="item">
            </div>
            <div class="viewCount" @click="showPop(item)">
              <van-icon name="chat" color="#a6acc1;" v-if="item.viewCount>=100" info="99+" />
              <van-icon name="chat" color="#a6acc1;" v-else :info="item.viewCount" />
            </div>
          </div>
        </van-list>
      </div>
    </van-pull-refresh>
    <van-popup id='popup' v-model="popShow" position="right" :overlay="false" style="z-index:2000">
      <div class="postInfo" v-show="postInfo!=null">
        <div class="postView">
          <img :src="postInfo.headImg" class='pheadImg'>
          <p class='nickName'>{{postInfo.nickName}}</p>
          <p class='commDate'>{{postInfo.publish_time|formatDate}}</p>
          <p class='pInfo' v-html='postInfo.content'></p>
        </div>
        <div>
          <img preview="999" class="pImg" v-for="(item, index) in postInfo.images" :key="index" v-lazy="item">
        </div>
      </div>
      <div class='tip'>ç”¨æˆ·å›å¤</div>
      <div class='command'>
        <div v-show="this.cList.length == 0" style="text-align: center;color:#878787;height:3rem;">
          <img class="sofa" src="http://jhyt.cyparty.com/resource/images/icon_not_comment.png">
          <p style="font-size: .25rem;">å¿«æ¥å‚ä¸è¯„è®ºå§ï¼</p>
        </div>
        <div class='comm  van-hairline--bottom' v-for="(item,index) in cList" :key="index" @click="onComment(item)">
          <img :src="item.headImg" class='headImg'>
          <p class='nickName'>{{item.nickName}}</p>
          <p class='commReply'>å›å¤è¯„è®º</p>
          <p class='commDate'>{{item.publish_time|formatDate}}</p>
          <p v-if="item.rncikName!=''" class='commRnickName'>å›å¤ï¼š{{item.rncikName}}</p>
          <p class='commInfo'>{{item.content}}</p>
        </div>
      </div>
      <div class="footer"></div>
    </van-popup>
    <van-popup v-model="show" position="bottom">
      <van-panel title="è¯„è®ºç•™è¨€" :desc="desc" status='æ–‡æ˜ä¸Šç½‘,éµå®ˆ"ä¸ƒæ¡åº•çº¿"'>
        <div>
          <van-cell-group>
            <van-field @input="checkText" clearable v-model="message" type="textarea" placeholder="è¯·è¾“å…¥ç•™è¨€" rows="3" autosize />
          </van-cell-group>
        </div>
        <div slot="footer">
          <p class="tcount">{{message.length}}/255</p>
          <van-button size="small" @click="submitComm" type="danger">å‘è¡¨è¯„è®º</van-button>
        </div>
      </van-panel>
    </van-popup>
    <van-goods-action v-show="actionShow" style="z-index:2001 !importent;">
      <van-goods-action-mini-btn icon="arrow-left" @click="popShow = false,actionShow=false">
        åé€€
      </van-goods-action-mini-btn>
      <!-- <van-goods-action-mini-btn icon="share" @click="onClickCart">
        åˆ†äº«
      </van-goods-action-mini-btn> -->
      <van-goods-action-big-btn class="commBtn" @click="onSubmit">
        <van-icon name="edit" /> å†™è¯„è®ºâ€¦
      </van-goods-action-big-btn>
      <van-goods-action-mini-btn icon="chat" :info="comment" @click="onSubmit">
        è¯„è®º
      </van-goods-action-mini-btn>
      <van-goods-action-mini-btn :icon="add" @click="onAdd">
        æ”¶è—
      </van-goods-action-mini-btn>
    </van-goods-action>
    <div class="footer"></div>
  </div>
</template>
<script>
  import qs from 'qs';
  import {
    Panel,
    PullRefresh,
    Uploader,
    Row,
    Col,
    Icon,
    Button,
    Popup,
    Loading,
    Toast,
    List,
    Swipe,
    SwipeItem,
    Field,
    Cell,
    CellGroup,
    GoodsAction,
    GoodsActionBigBtn,
    GoodsActionMiniBtn
  }
  from "vant";
  export default {
    data() {
      return {
        loadingShow: false, //åŠ è½½æ˜¾ç¤º
        fileList: [], //ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨æ•°æ®
        filetype: ['image', 'audio', 'video'], //æ–‡ä»¶ç±»å‹
        show: false, //è¯„è®ºå¼¹å‡ºå±‚æ˜¾ç¤ºoréšè—
        pMsg: '', //å¼¹å‡ºå±‚ä¿¡æ¯
        popShow: false, //è¯¦æƒ…å¼¹å‡ºå±‚æ˜¾ç¤ºoréšè—
        actionShow: false, //åŠ¨ä½œæ¡æ˜¾ç¤ºoréšè—
        uploading: false, //ä¸Šä¼ ç­‰å¾…å¼¹å‡ºå±‚
        filenum: 0, //ä¸Šä¼ æ–‡ä»¶å‰©ä½™æ•°é‡
        total: 0, //ä¸Šä¼ æ–‡ä»¶æ€»æ•°é‡
        loading: false,
        finished: false,
        page: 0, //åˆ—è¡¨åˆ·æ–°æ¬¡æ•°
        isLoading: false, //ä¸‹æ‹‰åˆ·æ–°
        images: [
          require('../../../static/images/1.jpg'),
          require('../../../static/images/2.jpg')
        ],
        postInfo: {},
        postList: [], //å¸–å­åˆ—è¡¨
        add: "add-o", //æ”¶è—
        comment: 0, //è¯„è®ºæ•°
        message: "", //è¯„è®ºå†…å®¹
        desc: "", //å›å¤äººæ˜¾ç¤º
        cList: [] //è¯„è®ºåˆ—è¡¨
      };
    },
    components: {
      [Panel.name]: Panel,
      [Uploader.name]: Uploader,
      [PullRefresh.name]: PullRefresh,
      [Icon.name]: Icon,
      [Button.name]: Button,
      [Row.name]: Row,
      [Col.name]: Col,
      [Popup.name]: Popup,
      [Loading.name]: Loading,
      [Toast.name]: Toast,
      [List.name]: List,
      [Swipe.name]: Swipe,
      [SwipeItem.name]: SwipeItem,
      [Cell.name]: Cell,
      [CellGroup.name]: CellGroup,
      [GoodsAction.name]: GoodsAction,
      [GoodsActionBigBtn.name]: GoodsActionBigBtn,
      [GoodsActionMiniBtn.name]: GoodsActionMiniBtn,
      [Field.name]: Field
    },
    created() {
      // this.$toast.loading({ mask: true, message: 'åŠ è½½ä¸­...',duration:0 });
      this.initList();
    },
    mounted() {
      this.comment = this.cList.length;
    },
    updated() {
      setTimeout(() => {
        this.loadingShow = false;
      }, 400);
      // setTimeout(() => {
      //   this.$toast.clear();
      // }, 400);
    },
    methods: {
      onPublish(){
        this.$router.push({
            path: "/publish"
          });
      },
      clicked(index) {
        if (index == 0) {
          this.$router.push({
            path: "/uploadImg"
          });
        }
      },
      initList() {
        this.postList = [{
            user_id: 1,
            nickName: "æµ‹è¯•ç”¨æˆ·1",
            content: "æ–°åç¤¾åŒ—äº¬7æœˆ13æ—¥ç”µï¼ˆè®°è€…é™ˆé”®å…´ï¼‰13æ—¥ä¸Šåˆï¼Œä¸­å…±ä¸­å¤®æ€»ä¹¦è®°ä¹ è¿‘å¹³åœ¨äººæ°‘å¤§ä¼šå ‚ä¼šè§ä¸­å›½å›½æ°‘å…šå‰ä¸»å¸­è¿æˆ˜ç‡é¢†çš„å°æ¹¾å„ç•Œäººå£«å‚è®¿å›¢æ—¶å¼ºè°ƒï¼Œå¤§é“ä¹‹è¡Œã€äººå¿ƒæ‰€å‘ï¼ŒåŠ¿ä¸å¯æŒ¡ã€‚æˆ‘ä»¬æœ‰å……åˆ†çš„ä¿¡å¿ƒå’Œè¶³å¤Ÿçš„èƒ½åŠ›ï¼Œç‰¢ç‰¢æŠŠæ¡æ­£ç¡®æ–¹å‘ï¼Œåšå®šä¸ç§»æ¨åŠ¨ä¸¤å²¸å…³ç³»å’Œå¹³å‘å±•ã€æ¨è¿›ç¥–å›½å’Œå¹³ç»Ÿä¸€è¿›ç¨‹ã€‚å¸Œæœ›ä¸¤å²¸åŒèƒå…±åŒåŠªåŠ›ï¼ŒåšæŒä½“ç°ä¸€ä¸ªä¸­å›½åŸåˆ™çš„â€œä¹äºŒå…±è¯†â€ï¼Œåšå†³åå¯¹å’Œéåˆ¶â€œå°ç‹¬â€ï¼Œæ‰©å¤§æ·±åŒ–ä¸¤å²¸å„é¢†åŸŸäº¤æµåˆä½œï¼Œå¢è¿›åŒèƒäº²æƒ…ç¦ç¥‰ï¼Œåœ¨æ–°æ—¶ä»£æºæ‰‹åŒå¿ƒä¹¦å†™ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´æ–°ç¯‡ç« ã€‚<br>ä¹ è¿‘å¹³æŒ‡å‡ºï¼Œâ€œä¸ç•æµ®äº‘é®æœ›çœ¼ï¼Œè‡ªç¼˜èº«åœ¨æœ€é«˜å±‚ã€‚â€åªè¦å¤§å®¶ç™»é«˜æœ›è¿œï¼Œå°±èƒ½çœ‹æ¸…ä¸»æµã€æŠŠæ¡å¤§åŠ¿ï¼Œå…±åŒæ¨åŠ¨ä¸¤å²¸å…³ç³»å…‹éš¾å‰è¡Œã€‚æˆ‘ä»¬å¯¹ä¸¤å²¸å…³ç³»æœªæ¥å……æ»¡ä¿¡å¿ƒï¼Œå› ä¸ºæ¨åŠ¨ä¸¤å²¸å…³ç³»å’Œå¹³å‘å±•ã€æºæ‰‹è‡´åŠ›æ°‘æ—å¤å…´ï¼Œæ˜¯ç¬¦åˆæ°‘æ—æ•´ä½“åˆ©ç›Šã€é¡ºåº”æ—¶ä»£æ½®æµã€é€ ç¦ä¸¤å²¸åŒèƒã€å¾—åˆ°ä¸¤å²¸åŒèƒæ‹¥æŠ¤çš„æ­£ç¡®é“è·¯ï¼›å› ä¸ºä¸ç®¡ç»å†å¤šå°‘é£é›¨ï¼Œä¸¤å²¸åŒèƒåœ¨æ°‘æ—ã€æ–‡åŒ–è®¤åŒå’Œæƒ…æ„Ÿä¸Šä»æœªåˆ†ç¦»ï¼›å› ä¸ºå°½ç®¡æ•°åå¹´æ¥ä¸¤å²¸å…³ç³»è·Œå®•èµ·ä¼ï¼Œä½†æ€»ä½“è¶‹åŠ¿æ˜¯å‘å‰å‘å±•çš„ï¼›å› ä¸ºä¸¤å²¸æ˜¯å¯†ä¸å¯åˆ†ã€ä¼‘æˆšä¸å…±çš„å‘½è¿å…±åŒä½“ã€‚ä¸¤å²¸åŒèƒå¯¹æ›´åŠ ç¾å¥½ç”Ÿæ´»çš„å…±åŒè¿½æ±‚ï¼Œå¯¹ä¸¤å²¸å…³ç³»èµ°è¿‘èµ°å¥½çš„ä¸€è‡´å‘å¾€ï¼Œæ˜¯ä»»ä½•äººéƒ½é˜»æŒ¡ä¸äº†çš„ã€‚<br>ä¹ è¿‘å¹³æŒ‡å‡ºï¼Œâ€œä¸å¿˜åˆå¿ƒï¼Œæ–¹å¾—å§‹ç»ˆã€‚â€æ­£ç¡®é“è·¯è¦åšæŒèµ°ä¸‹å»ã€‚ç‰¹åˆ«æ˜¯åœ¨å½“å‰å°æµ·å½¢åŠ¿ä¸‹ï¼Œä¸¤å²¸åŒèƒæ›´è¦åšå®šä¿¡å¿ƒï¼Œå›¢ç»“å‰è¡Œã€‚",
            headImg: "http://image.yy.com/yywebalbumbs2bucket/46783fac143b433891c652219b942864_1514110116802.jpg",
            publish_time: "2018-07-15 10:29:56",
            viewCount: '100',
            images: [
              require('../../../static/images/1.jpg'),
              require('../../../static/images/2.jpg'),
            ]
          },
          {
            user_id: 2,
            nickName: "æµ‹è¯•ç”¨æˆ·2",
            rncikName: "æµ‹è¯•ç”¨æˆ·3",
            content: "ä»Šå¤©å¿ƒæƒ…ä¸é”™ï¼",
            headImg: "http://img3.imgtn.bdimg.com/it/u=20733103,1267671152&fm=27&gp=0.jpg",
            publish_time: "2018-07-14 10:29:56",
            viewCount: '16',
            images: [
              require('../../../static/images/1.jpg'),
            ]
          },
          {
            user_id: 2,
            nickName: "æµ‹è¯•ç”¨æˆ·2",
            rncikName: "æµ‹è¯•ç”¨æˆ·3",
            content: "å‘ä¸ªç…ç…",
            headImg: "http://img3.imgtn.bdimg.com/it/u=20733103,1267671152&fm=27&gp=0.jpg",
            publish_time: "2018-07-14 10:29:56",
            viewCount: '3',
            images: [

            ]
          }
        ]
      },
      onRefresh() {
        this.page = 0;
        this.finished = false;
        setTimeout(() => {
          this.initList();
          this.isLoading = false;
        }, 500);
      },
      getList() {
        let p = 0;
        p = this.page;
        let res = [{
          user_id: 3,
          nickName: "æµ‹è¯•ç”¨æˆ·3",
          content: "å“ˆå“ˆå“ˆï¼ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ ",
          headImg: "http://img5.imgtn.bdimg.com/it/u=3527916118,1559491205&fm=27&gp=0.jpg",
          publish_time: "2018-07-13 10:29:56",
          viewCount: '0',
          images: []
        }, {
          user_id: 3,
          nickName: "æµ‹è¯•ç”¨æˆ·3",
          content: "æ„Ÿè§‰è¿˜ä¸é”™",
          headImg: "http://img5.imgtn.bdimg.com/it/u=3527916118,1559491205&fm=27&gp=0.jpg",
          publish_time: "2018-07-13 10:29:56",
          viewCount: '8',
          images: []
        }, {
          user_id: 3,
          nickName: "æµ‹è¯•ç”¨æˆ·3",
          content: "å‘ä¸ªå¸–å­æµ‹è¯•ä¸€ä¸‹ğŸ˜ƒ",
          headImg: "http://img5.imgtn.bdimg.com/it/u=3527916118,1559491205&fm=27&gp=0.jpg",
          publish_time: "2018-07-13 10:29:56",
          viewCount: '200',
          images: []
        }]

        if (res.length != 0) {
          if (JSON.stringify(this.postList[this.postList.length - 1]).indexOf(JSON.stringify(res[res.length - 1])) == -
            1) {
            this.page++;
            this.postList = this.postList.concat(res);
          } else {
            this.finished = true;
          }
        } else {
          this.finished = true;
        }
        this.loading = false;
      },
      checkText() {
        if (this.message.length > 255) {
          this.message = this.message.substring(0, 255);
        }
      },
      onComment(obj) {
        this.show = true;
        this.rncikName = obj.nickName;
        this.desc = "å›å¤ï¼š" + obj.nickName;
      },
      onAdd() {
        if (this.add === "add") {
          this.add = "add-o";
        } else {
          this.add = "add";
        }
      },
      onSubmit() {
        this.show = true;
        this.rncikName = "";
      },
      submitComm() {
        var date = new Date();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
          month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
          strDate = "0" + strDate;
        }
        var currentDate =
          date.getFullYear() +
          "-" +
          month +
          "-" +
          strDate +
          " " +
          date.getHours() +
          ":" +
          date.getMinutes() +
          ":" +
          date.getSeconds();
        let obj = {};
        this.$set(obj, "user_id", 4);
        this.$set(obj, "nickName", "æµ‹è¯•ç”¨æˆ·4");
        this.$set(obj, "content", this.message);
        this.$set(
          obj,
          "headImg",
          "http://img3.imgtn.bdimg.com/it/u=3716833014,2060263550&fm=27&gp=0.jpg"
        );
        this.$set(obj, "publish_time", currentDate);
        this.$set(obj, "rncikName", this.rncikName);
        this.comment = this.cList.unshift(obj);
        this.show = false;
        this.message = "";
      },
      //ç¡çœ å‡½æ•° numberMillis -- è¦ç¡çœ çš„æ¯«ç§’æ•°
      sleep(numberMillis) {

        var now = new Date();
        var exitTime = now.getTime() + numberMillis;
        while (true) {
          now = new Date();
          if (now.getTime() > exitTime) {
            return;
          }
        }
      },
      showPop(obj) {

        this.popShow = true;
        this.actionShow = true;

        this.postInfo = obj;

        this.$previewRefresh();

        this.cList = [{
            user_id: 1,
            nickName: "æµ‹è¯•ç”¨æˆ·1",
            rncikName: "",
            content: "åˆ°æ­¤ä¸€æ¸¸ğŸ˜ğŸ˜ğŸ˜ğŸ˜",
            headImg: "http://image.yy.com/yywebalbumbs2bucket/46783fac143b433891c652219b942864_1514110116802.jpg",
            publish_time: "2018-06-25 10:29:56"
          },
          {
            user_id: 2,
            nickName: "æµ‹è¯•ç”¨æˆ·2",
            rncikName: "æµ‹è¯•ç”¨æˆ·3",
            content: "æ”¯æŒï¼æ”¯æŒï¼ğŸ˜ğŸ˜",
            headImg: "http://img3.imgtn.bdimg.com/it/u=20733103,1267671152&fm=27&gp=0.jpg",
            publish_time: "2018-06-22 10:29:56"
          },
          {
            user_id: 3,
            nickName: "æµ‹è¯•ç”¨æˆ·3",
            rncikName: "",
            content: "å…ˆè¯„è®ºå†æŠ¢æ²™å‘ï¼å“ˆå“ˆå“ˆï¼ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ",
            headImg: "http://img5.imgtn.bdimg.com/it/u=3527916118,1559491205&fm=27&gp=0.jpg",
            publish_time: "2018-06-08 10:29:56"
          }
        ]
        this.comment = this.cList.length;
      },
      //æäº¤ä¸Šä¼ 
      subClick() {
        this.filenum = 0;
        if (this.fileList.length != 0) {
          this.total = this.fileList.length;
          this.uploading = true;

          for (let i = 0; i < this.fileList.length; i++) {
            this.axios.post(
                "http://10.81.108.54:8080/api/file/uploadFile", qs.stringify({
                  fileBase64Code: this.fileList[i].content.split(',')[1],
                  fileType: this.fileList[i].type,
                  fileName: this.fileList[i].name,
                  size: this.fileList[i].size
                })
              )
              .then(
                res => {
                  // this.sleep(1000); //ä¼‘çœ 1000æ¯«ç§’
                  // å“åº”æˆåŠŸå›è°ƒ
                  if (i == this.total - 1) {
                    setTimeout(() => {
                      this.uploading = false;
                    }, 2000);
                  }
                  this.fileList.splice(this.fileList.indexOf(this.fileList[i]), 1);
                  this.filenum++;
                }
              ).catch(
                error => {
                  if (i == this.total - 1) {
                    setTimeout(() => {
                      this.uploading = false;
                    }, 2000);
                  }
                  this.pMsg = 'ç”±äºç½‘ç»œåŸå› ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡æ–°ä¸Šä¼ ';
                  this.show = true;
                  setTimeout(() => {
                    this.show = false;
                    this.pMsg = '';
                  }, 4000);
                });
          }
        }

      },
      logContent(file) {
        // console.log(file);
        this.pMsg = 'æ–‡ä»¶è¶…è¿‡10Mæ— æ³•ä¸Šä¼ ';
        this.show = true;
        setTimeout(() => {
          this.show = false;
          this.pMsg = '';
        }, 4000);
      },
      affterRead() {
        return file => {

          if (file.length > 1) {
            for (let i = 0; i < file.length; i++) {
              if (file[i].file.type.indexOf('image') != -1 || file[i].file.type.indexOf('video') != -1) {
                //å‹ç¼©å›¾ç‰‡
                this.cutImg(file[i])
              } else {
                this.pMsg = 'ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼';
                this.show = true;
                setTimeout(() => {
                  this.show = false;
                  this.pMsg = '';
                }, 1500);
              }
            }
          } else {
            if (file.file.type.indexOf('image') != -1 || file.file.type.indexOf('video') != -1) {
              //å‹ç¼©å›¾ç‰‡
              this.cutImg(file)
            } else {
              this.pMsg = 'ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼';
              this.show = true;
              setTimeout(() => {
                this.show = false;
                this.pMsg = '';
              }, 2000);
            }
          }
        }
      },
      // showImg(img) {
      //   // const instance = ImagePreview([img])
      //   console.log(img)
      // },
      clearItem(i) {
        this.fileList.splice(i, 1);
      },
      cutImg(file) {
        var that = this;
        var item = {}; //å‹ç¼©åå¯¹è±¡
        if (file.file.type.indexOf('image') == 0) {
          // å‹ç¼©å›¾ç‰‡éœ€è¦çš„ä¸€äº›å…ƒç´ å’Œå¯¹è±¡
          var img = new Image();
          // console.log(file.content)
          img.src = file.content;
          // ç¼©æ”¾å›¾ç‰‡éœ€è¦çš„canvas
          var canvas = document.createElement('canvas');
          var context = canvas.getContext('2d');
          var width = 1080; //å›¾åƒå¤§å°
          var quality = 0.8; //å›¾åƒè´¨é‡

          img.onload = function (e) {
            // å›¾ç‰‡åŸå§‹å°ºå¯¸
            var w = img.width;
            var h = img.height;
            if (w > 1080) {
              canvas.width = width;
              canvas.height = width * (h / w);
              // åœ¨canvasç»˜åˆ¶å‰å¡«å……ç™½è‰²èƒŒæ™¯  
              context.fillStyle = "#fff";
              context.fillRect(0, 0, canvas.width, canvas.height);
              context.lineTo(canvas.width, canvas.height);
              // å›¾ç‰‡å‹ç¼©
              context.drawImage(img, 0, 0, canvas.width, canvas.height);
              item.content = canvas.toDataURL("image/jpeg", quality);
              var blob = that.dataURItoBlob(canvas.toDataURL("image/jpeg", quality));
              item.type = blob.type;
              item.size = blob.size;
              item.name = file.file.name;
            } else {
              item.type = file.file.type;
              item.name = file.file.name;
              item.content = file.content;
              item.size = file.file.size;
            }

            that.fileList = that.fileList.concat(item)
          }
        } else {
          item.type = file.file.type;
          item.name = file.file.name;
          item.content = file.content;
          item.size = file.file.size;
          that.fileList = that.fileList.concat(item)
        }

      },
      //base64 è½¬ blob å¯¹è±¡
      dataURItoBlob(dataURI) {
        var byteString = atob(dataURI.split(',')[1]);
        var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
        var ab = new ArrayBuffer(byteString.length);
        var ia = new Uint8Array(ab);
        for (var i = 0; i < byteString.length; i++) {
          ia[i] = byteString.charCodeAt(i);
        }
        return new Blob([ab], {
          type: mimeString
        });
      }
    },
    beforeRouteEnter(to, from, next) {
      if (from.meta.index == "1") {
        window.scrollTo(0, 0);
      }
      next();
    },
    deactivated() {
      this.actionShow = false;
    }
  }

  ;

</script>
<style>
  @import "../../../static/CSS/index.css";
  @import "../../../static/CSS/details.css";
  @import "../../../static/CSS/publish.css";

</style>
